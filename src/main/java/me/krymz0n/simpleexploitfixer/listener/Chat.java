package me.krymz0n.simpleexploitfixer.listener;

import io.papermc.paper.event.player.AsyncChatEvent;
import me.krymz0n.simpleexploitfixer.Main;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.AsyncPlayerChatEvent;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Chat implements Listener {
    private static final Pattern httpRegexCheck =
            Pattern.compile("(https?://(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]" +
                    "[a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?://(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})", Pattern.CASE_INSENSITIVE);
    private final Main plugin;

    public Chat(Main plugin) {
        this.plugin = plugin;
    }

    @EventHandler
    private void onChat(AsyncPlayerChatEvent evt) {
        Player p = evt.getPlayer();
        if (link(evt.getMessage())) {
            evt.setCancelled(true);
        }
    }

    public static boolean link(String s) {
        Matcher matcher = httpRegexCheck.matcher(s);
        return matcher.find();
    }
}

