package me.krymz0n.simpleexploitfixer.listener.misc;

import me.krymz0n.simpleexploitfixer.Main;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.player.AsyncPlayerChatEvent;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Chat implements Listener {
    private static final Pattern httpRegexCheck =
            Pattern.compile("(https?://(?:www\\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]" +
                    "[a-zA-Z0-9-]+[a-zA-Z0-9]\\.[^\\s]{2,}|https?://(?:www\\.|(?!www))[a-zA-Z0-9]+\\.[^\\s]{2,}|www\\.[a-zA-Z0-9]+\\.[^\\s]{2,})", Pattern.CASE_INSENSITIVE); //added discord link to the regex
    private final Main plugin;

    public Chat(Main plugin) {
        this.plugin = plugin;
    }

    @EventHandler
    private void onChat(AsyncPlayerChatEvent evt) {
        if (plugin.getConfig().getBoolean("PreventAllLinks")) { // need to fix all of this
            Player p = evt.getPlayer();
            if (link(evt.getMessage())) {
                evt.setCancelled(true);
            }

            if (evt.getMessage().contains("discord.gg")
                    || evt.getMessage().contains("discord.com")
                    || evt.getMessage().contains("discord.media")
                    || evt.getMessage().contains("discordapp.com")
                    || evt.getMessage().contains("discordapp.net")
                    || evt.getMessage().contains("discordstatus.com")) {
                evt.setCancelled(true);
            }
        }
    }

    public static boolean link(String s) {
        Matcher matcher = httpRegexCheck.matcher(s);
        return matcher.find();
    }
}

